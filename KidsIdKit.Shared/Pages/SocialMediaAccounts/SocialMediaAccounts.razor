@page "/childSocialMediaAccounts/{Id:int}"

@using System.Linq.Expressions;
@using System.ComponentModel.DataAnnotations;
@using System.Reflection;
@using Microsoft.AspNetCore.Components.QuickGrid;
@using KidsIdKit.Shared.Data;

@inject IDataAccess dal
@inject NavigationManager NavigationManager

@if (CurrentChild == null || SocialMediaAccountList == null)
{
    <h2>Social Media Accounts</h2>
    <p>Loading...</p>
}
else
{
    <h2>@CurrentChild.FullName</h2>
    <p></p>
    <h3>Social Media Accounts</h3>
    <p></p>

    <QuickGrid Items="@SocialMediaAccountList">
        <TemplateColumn>
            <div class="content-card"
                 title="Click to edit @context.Platform"
                 style="cursor: pointer;"
                 @onclick="@(() => NavigateToEdit(context))"
                 @onclick:stopPropagation="false">
@*                 <h4>@context.ChildDetails.FullName</h4> *@
                <p>@context.Platform</p>
                <p>@context.UserName</p>
            </div>
        </TemplateColumn>

        <TemplateColumn>
            <a href="/SocialMediaAccount/@Id/@context.Id" style="text-decoration:none"><i class="fas fa-edit"></i></a>
        </TemplateColumn>
    </QuickGrid>

    <div>
        <button type="button"
                @onclick="@(() => NavigationManager.NavigateTo($"/Child/{Id}"))"
                title="Back"
                class="btn-back">
            <i class="fas fa-chevron-left" />
        </button>

@*         <button type="button"
                @onclick="@(() => NavigationManager.NavigateTo($"/SocialMediaAccount/{Id}/-1"))"
                title="Add social media"
                class="btn-icon">
            <i class="fas fa-plus" />
        </button> *@
    </div>
}

@code {
    [Parameter] public int Id { get; set; }

    ChildDetails? CurrentChild { get; set; }
    IQueryable<SocialMediaAccount>? SocialMediaAccountList { get; set; }

    protected override void OnParametersSet()
    {
        ArgumentNullException.ThrowIfNull(DataStore.Family);
        Child currentChild = DataStore.Family.Children[Id];
        CurrentChild = currentChild.ChildDetails;
        SocialMediaAccountList = currentChild.SocialMediaAccounts.AsQueryable();
    }

    // private void NavigateToEdit(Data.Child child)
    // {
    //     if (DataStore.Family != null)
    //     {
    //         var index = DataStore.Family.Children.IndexOf(child);
    //         NavigationManager.NavigateTo($"/Child/{index}");
    //     }
    // }

    private void NavigateToEdit(Data.SocialMediaAccount socialMediaAccount)
    {
        // if (DataStore.Family.Children.SocialMediaAccounts != null)
        // if (CurrentChild != null)
        if (socialMediaAccount != null)
        {
            // var index = DataStore.Family.Children.IndexOf(socialMediaAccount);
            // var index = socialMediaAccount.Id;
            // NavigationManager.NavigateTo($"/Child/{index}");
            NavigationManager.NavigateTo($"/SocialMediaAccount/{socialMediaAccount.Id}");

            // <a href="/SocialMediaAccount/@Id/@context.Id" style="text-decoration:none"><i class="fas fa-edit"></i></a>
        }
    }
}
