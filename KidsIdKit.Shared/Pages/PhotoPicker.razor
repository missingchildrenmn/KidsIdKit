@inject NavigationManager NavigationManager

@using Microsoft.AspNetCore.Components.Forms

<h3>Select an Image</h3> 

<InputFile OnChange="FileSelected" />

<div>
    @if (!string.IsNullOrEmpty(imageSource))
    {
        <img src="@imageSource" />
        <br />
        <button style="btn btn-primary" @onclick="UseFile">Use image</button>
    }
</div>

@code 
{
    [Parameter]
    public EventCallback<string> Complete { get; set; }
    private string? imageSource;

    protected override void OnInitialized()
    {
        ArgumentNullException.ThrowIfNull(Complete);
    }

    private async Task FileSelected(InputFileChangeEventArgs e)
    {
        if (e.File != null)
        {
            using var stream = e.File.OpenReadStream();
            using var ms = new MemoryStream();
            await stream.CopyToAsync(ms);
            var file = e.File;
            imageSource = $"data:{file.ContentType};base64,{Convert.ToBase64String(ms.ToArray())}";
        }
    }

    private async Task UseFile()
    {
        if (!string.IsNullOrEmpty(imageSource))
        {
            await Complete.InvokeAsync(imageSource);
        }
    }
}