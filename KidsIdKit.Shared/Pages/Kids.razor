@page "/"

@inject Data.IDataAccess dal
@inject NavigationManager NavigationManager

@using Microsoft.AspNetCore.Components.QuickGrid

<h1>Kids</h1>

@if (data == null || DataStore.Family == null)
{
  <p>Loading data...</p>
}
else
{
    <QuickGrid Items="@data" Class="full-width-column">
        <TemplateColumn Class="full-width-column">
            <div class="content-card" 
                 title="Click to edit @context.ChildDetails.FullName"
                 style="cursor: pointer;"
                 @onclick="@(() => NavigateToEdit(context))"
                 @onclick:stopPropagation="false">
                <h4>@context.ChildDetails.FullName</h4>

                <div>
                    <div>Age @context.ChildDetails.Age (@context.ChildDetails.Birthday.ToString("d"))</div>
                    @if (!string.IsNullOrWhiteSpace(context.ChildDetails.Names))
                    {
                        <div><i>@context.ChildDetails.Names</i></div>
                    }
                </div>

                @if (!string.IsNullOrWhiteSpace(context.ChildDetails.Photo.ImageSource))
                {
                    <div><img src="@context.ChildDetails.Photo.ImageSource" height="100" width="100" /></div>
                }

                <div class="actions">
                    <div title="Remove @context.ChildDetails.GivenName"
                         @onclick="@((e) => NavigateToRemove(context, e))"
                         @onclick:stopPropagation="true"
                         style="cursor: pointer;">
                        <i class="fas fa-trash-alt"></i>
                    </div>
                </div>
            </div>
        </TemplateColumn>
    </QuickGrid>
    
    <div>
        <button type="button"
            class="btn-icon"
            title="Add new child"
                @onclick="@(() => NavigationManager.NavigateTo("/Child/-1"))">
            <i class="fas fa-plus" />
        </button>
    </div>
}

@code {
    private IQueryable<Data.Child>? data;

    protected override async Task OnInitializedAsync()
    {
        DataStore.Family = await dal.GetDataAsync();
        if (DataStore.Family is not null)
        {
            data = DataStore.Family.Children.AsQueryable();
        }
    }

    private void NavigateToEdit(Data.Child child)
    {
        if (DataStore.Family != null)
        {
            var index = DataStore.Family.Children.IndexOf(child);
            NavigationManager.NavigateTo($"/Child/{index}");
        }
    }

    private void NavigateToRemove(Data.Child child, MouseEventArgs e)
    {
        if (DataStore.Family != null)
        {
            var index = DataStore.Family.Children.IndexOf(child);
            NavigationManager.NavigateTo($"/ChildRemove/{index}");
        }
    }
}
